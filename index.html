<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="./css/pure-min.css" />
<link rel="stylesheet" href="./css/styles.css" />
<style>
	body {
		position: relative;
	}
    #a1 { 
		position: absolute;
		width: 100%;
		top: 0;
		bottom: 0;
		left: 0;
		right: 0;
	}
</style>
<title>youtube 免翻墙视频播放器</title>
</head>
<body>
<div id="a1"></div>
<script src="./js/jquery.min.js"></script>
<script src="./ckplayer/ckplayer.js" charset="utf-8"></script>
<script src="./js/util.js"></script>
<script type="text/javascript">
	function play() {
		var youtubeLink = parseURL(location.href).query.replace('?url=','') || '';
		if(!youtubeLink){
			alert('缺少参数');
			return false;
		}
		var fileUrl;
		var key = MD5(youtubeLink);
		var storage = window.localStorage;
		// 已经解析过地址，从本地缓存中取即可
		if(storage.getItem(key)){
			fileUrl = storage.getItem(key);
			console.log("从缓存中取地址： "+fileUrl);
			var flashvars={
				f: fileUrl,
				c:0,
				b:1
			};
			var params={bgcolor:'#FFF',allowFullScreen:true,allowScriptAccess:'always',wmode:'transparent'};
			CKobject.embedSWF('/ckplayer/ckplayer.swf','a1','ckplayer_a1','800','600',flashvars,params);
			return;
		}

		var host = 'https://youtubeinmp4.com/';
		var XPath = '//a[contains(@id,"downloadMP4")]';
		var pageUrl = 'https://youtubeinmp4.com/youtube.php?video=' + encodeURIComponent(youtubeLink);
		var dataYrl =  transformYql(pageUrl,XPath,'json'); // yql地址
		$.getJSON(dataYrl,function(json) {
			if(json.query.results.a.length > 0){
				fileUrl = host + json.query.results.a[1].href;
				storage.setItem(key,fileUrl);
				var flashvars={
					f: fileUrl,
					c:0,
					b:1
				};
				var params={bgcolor:'#FFF',allowFullScreen:true,allowScriptAccess:'always',wmode:'transparent'};
				CKobject.embedSWF('./ckplayer/ckplayer.swf','a1','ckplayer_a1','800','600',flashvars,params);
			}else{
				return false;
			}
		});
					
	}
	play();	
</script>
</body>
</html>
