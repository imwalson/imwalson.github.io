<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>youtube 免翻墙视频播放器</title>
<link rel="stylesheet" href="./css/pure-min.css" />
<link rel="stylesheet" href="./css/styles.css" />
<style>
	body {
		position: relative;
	}
    #a1 { 
		position: absolute;
		width: 100%;
		top: 0;
		bottom: 0;
		left: 0;
		right: 0;
	}
</style>
</head>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1261639880'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1261639880%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-96556558-1', 'auto');
  ga('send', 'pageview');

</script>
<body>
<div id="a1"></div>
<script src="./js/jquery.min.js"></script>
<script src="./ckplayer/ckplayer.js" charset="utf-8"></script>
<script src="./js/util.js"></script>
<script type="text/javascript">
	function play() {
		var youtubeLink = parseURL(location.href).query.replace('?url=','') || '';
		if(!youtubeLink){
			alert('缺少参数');
			return false;
		}
		var fileUrl;
		var key = MD5(youtubeLink);
		var storage = window.localStorage;
		// 已经解析过地址，从本地缓存中取即可
		if(storage.getItem(key)){
			fileUrl = storage.getItem(key);
			console.log("从缓存中取地址： "+fileUrl);
			var flashvars={
				f: fileUrl,
				c:0,
				b:1
			};
			var params={bgcolor:'#FFF',allowFullScreen:true,allowScriptAccess:'always',wmode:'transparent'};
			CKobject.embedSWF('/ckplayer/ckplayer.swf','a1','ckplayer_a1','800','600',flashvars,params);
			return;
		}

		var host = 'https://youtubeinmp4.com/';
		var XPath = '//a[contains(@id,"downloadMP4")]';
		var pageUrl = 'https://youtubeinmp4.com/youtube.php?video=' + encodeURIComponent(youtubeLink);
		var dataYrl =  transformYql(pageUrl,XPath,'json'); // yql地址
		$.getJSON(dataYrl,function(json) {
			if(json.query.results.a.length > 0){
				fileUrl = host + json.query.results.a[1].href;
				storage.setItem(key,fileUrl);
				var flashvars={
					f: fileUrl,
					c:0,
					b:1
				};
				var params={bgcolor:'#FFF',allowFullScreen:true,allowScriptAccess:'always',wmode:'transparent'};
				CKobject.embedSWF('./ckplayer/ckplayer.swf','a1','ckplayer_a1','800','600',flashvars,params);
			}else{
				return false;
			}
		});
					
	}
	play();	
</script>
</body>
</html>
